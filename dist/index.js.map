{"version":3,"file":"index.js","sources":["../src/context.ts","../src/storage.ts","../src/errors.ts","../src/logic.ts","../src/AlexandriaProvider.tsx","../src/useAlexandria.ts","../src/create.tsx"],"sourcesContent":["import { createContext } from \"react\"\n\nimport { TAlexandriaContext } from \"./types\"\n\n// export const AlexandriaContext = createContext<TAlexandriaContext<any>>({} as never)\n\nexport const createAlexandriaContext = <TypedSettings extends {}>() => {\n\treturn createContext<TAlexandriaContext<TypedSettings>>({} as never)\n}","export const isServer = typeof window === \"undefined\"\n\nexport const saveObject = <T>(key: string, value: T): void => {\n\tif (isServer) return\n\n\ttry {\n\t\tlocalStorage.setItem(key, JSON.stringify(value))\n\t} catch (e) {\n\t\t// Unsupported\n\t}\n}\n\nexport const getBlob = (key: string): string | undefined => {\n\tif (isServer) return undefined\n\n\tlet blob\n\n\ttry {\n\t\tblob = localStorage.getItem(key) || undefined\n\t} catch (e) {\n\t\t// Unsupported\n\t}\n\n\treturn blob || undefined\n}\n\nexport const getSavedObject = <T>(key: string, fallback: T): T => {\n\tconst blob = getBlob(key)\n\n\tif (typeof blob === \"undefined\") {\n\t\tsaveObject(key, fallback)\n\t\treturn fallback\n\t}\n\n\tlet value: T = fallback\n\n\ttry {\n\t\tvalue = JSON.parse(blob) as T\n\t} catch (e) {\n\t\t// Invalid\n\t\tsaveObject(key, \"{}\")\n\t}\n\n\treturn value\n}\n","import { Schema } from \"./types\"\n\nconst PREFIX = \"Alexandria: \"\n\nexport const errors = {\n\tunknownSetting: (key: string): string =>\n\t\t`UNKNOWN_SETTING_ERROR: \"${key}\" is not a valid setting. If it should be, please update your schema in the AlexandriaProvider. Your mutation has been ignored and the setting was not changed.`,\n\tinvalidSettingValue: (key: string, value: string, schema: Schema): string =>\n\t\t`INVALID_SETTING_VALUE_ERROR: \"${value}\" is not an allowed value for setting \"${key}\". Your mutation has been ignored and the setting was not changed. The current allowed values are: ${schema[key].allow}. If you want to allow any value, set the \"allow\" property to \"*\".`,\n\tinvalidSchema: (schema: unknown): string =>\n\t\t`INVALID_SCHEMA_ERROR: The schema provided to the AlexandriaProvider is invalid. Got: \"${schema}\"`,\n\temptySchema: (): string =>\n\t\t`EMPTY_SCHEMA_ERROR: The schema provided to the AlexandriaProvider is empty. Please provide a schema with at least one setting.`,\n}\n\nexport const alexandriaError = (key: string, ...args: any[]) => {\n\tconst error = errors[key]\n\n\tif (typeof error === \"undefined\") {\n\t\tthrow new Error(`UNKNOWN_ERROR: ${key}`)\n\t}\n\n\treturn new Error(`${PREFIX}${error(...args)}`)\n}\n","import { alexandriaError } from \"./errors\"\nimport { Schema, SettingValue } from \"./types\"\n\nexport const isAllowedValue = (\n\tkey: string,\n\tvalue: SettingValue,\n\tschema: Schema\n): boolean => {\n\tconst setting = schema[key]\n\n\tif (\n\t\ttypeof setting === \"undefined\" ||\n\t\t(typeof setting.allow === \"undefined\" &&\n\t\t\ttypeof setting.validate === \"undefined\")\n\t) {\n\t\treturn false\n\t}\n\n\tif (!setting) return false\n\tif (setting.allow === \"*\") return true\n\n\tif (typeof setting.validate === \"function\") {\n\t\tconst valid = setting.validate(value)\n\t\tif (valid) return true\n\t\treturn false\n\t}\n\n\tif (typeof setting.allow === \"undefined\") return false\n\treturn setting.allow.includes(value as never)\n}\n\nexport const compileDefaultSettingsFromSchema = <TypedSettings extends {}>(\n\tschema: Schema\n): TypedSettings => {\n\tlet settings: Partial<TypedSettings> = {}\n\n\tif (typeof schema !== \"object\") {\n\t\tthrow alexandriaError(\"invalidSchema\", schema)\n\t}\n\n\tif (Object.keys(schema || {}).length === 0) {\n\t\tthrow alexandriaError(\"emptySchema\")\n\t}\n\n\tfor (const [key, value] of Object.entries(schema || {})) {\n\t\tsettings[key] = value.default\n\t}\n\n\treturn settings as TypedSettings // Caller is responsible for providing defaults\n}\n","import React, { useState } from \"react\"\n\nimport { createAlexandriaContext } from \"./context\"\nimport { getSavedObject } from \"./storage\"\nimport { compileDefaultSettingsFromSchema } from \"./logic\"\n\nimport type { Config, Schema } from \"./types\"\n\nconst defaultConfig: Config = {\n\tkey: \"alexandria\",\n}\n\ninterface Props {\n\tschema: Schema\n\tconfig?: Config\n\tchildren: React.ReactNode\n}\n\nexport const AlexandriaProvider = <TypedSettings extends {}>({\n\tschema,\n\tconfig: userConfig,\n\tchildren,\n}: Props) => {\n\tconst config: Config = {\n\t\t...defaultConfig,\n\t\t...userConfig,\n\t}\n\n\tconst AlexandriaContext = createAlexandriaContext<TypedSettings>()\n\n\tconst defaultSettings = compileDefaultSettingsFromSchema(\n\t\tschema\n\t) as TypedSettings\n\n\tconst loadSettings = (): TypedSettings => {\n\t\treturn getSavedObject(config.key, defaultSettings)\n\t}\n\n\tconst [settings, setSettings] = useState<TypedSettings>(() => {\n\t\treturn {\n\t\t\t...defaultSettings,\n\t\t\t...loadSettings(),\n\t\t}\n\t})\n\n\treturn (\n\t\t<AlexandriaContext.Provider\n\t\t\tvalue={{\n\t\t\t\tsettings,\n\t\t\t\tsetSettings,\n\t\t\t\tschema,\n\t\t\t\tconfig,\n\t\t\t}}\n\t\t>\n\t\t\t{children}\n\t\t</AlexandriaContext.Provider>\n\t)\n}\n","import { useContext, useEffect, useState } from \"react\"\n\nimport { createAlexandriaContext } from \"./context\"\nimport { compileDefaultSettingsFromSchema, isAllowedValue } from \"./logic\"\nimport { getSavedObject, saveObject } from \"./storage\"\nimport { alexandriaError } from \"./errors\"\n\nimport { AlexandriaOperatingContext, SettingValue } from \"./types\"\n\nexport const useAlexandria = <\n\tTypedSettings extends {}\n>(): AlexandriaOperatingContext<TypedSettings> & TypedSettings => {\n\tconst AlexandriaContext = createAlexandriaContext<TypedSettings>()\n\n\tconst { settings, setSettings, schema, config } =\n\t\tuseContext(AlexandriaContext)\n\n\tconst defaultSettings =\n\t\tcompileDefaultSettingsFromSchema<TypedSettings>(schema)\n\n\tconst [isServer, setIsServer] = useState(true)\n\n\tconst knownSettings = Object.keys(\n\t\tdefaultSettings\n\t) as (keyof TypedSettings)[]\n\tconst isKnownSetting = (key: keyof TypedSettings): boolean =>\n\t\tknownSettings.includes(key)\n\n\tconst validateSettings = (\n\t\tsettingsToValidate: TypedSettings\n\t): TypedSettings => {\n\t\tlet newSettings: Partial<TypedSettings> = {}\n\n\t\tfor (const [key, value] of Object.entries(settingsToValidate)) {\n\t\t\tconst known = isKnownSetting(key as keyof TypedSettings)\n\t\t\tconst allowed = isAllowedValue(key, value as SettingValue, schema)\n\n\t\t\tif (known) {\n\t\t\t\tif (allowed) {\n\t\t\t\t\t// @ts-ignore\n\t\t\t\t\tnewSettings[key] = value as never\n\t\t\t\t} else {\n\t\t\t\t\t// @ts-ignore\n\t\t\t\t\tnewSettings[key] = settings[key]\n\t\t\t\t\tthrow alexandriaError(\n\t\t\t\t\t\t\"invalidSettingValue\",\n\t\t\t\t\t\tkey,\n\t\t\t\t\t\tvalue,\n\t\t\t\t\t\tschema\n\t\t\t\t\t)\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn newSettings as TypedSettings\n\t}\n\n\tconst setWithValidation = (\n\t\tcb: (settings: TypedSettings) => TypedSettings\n\t) => {\n\t\tsetSettings(settings => validateSettings(cb(settings as TypedSettings)))\n\t}\n\n\tconst loadSettings = () => {\n\t\treturn getSavedObject(config.key, defaultSettings)\n\t}\n\n\tuseEffect(() => {\n\t\tif (!window.localStorage) return\n\n\t\tsetIsServer(false)\n\t\tconst savedSettings = loadSettings()\n\n\t\tif (Object.keys(savedSettings).length === 0) {\n\t\t\tsetSettings(defaultSettings)\n\t\t}\n\n\t\tsetSettings(validateSettings(savedSettings as TypedSettings))\n\t}, [])\n\n\tuseEffect(() => {\n\t\tif (JSON.stringify(loadSettings()) !== JSON.stringify(settings)) {\n\t\t\tsaveObject(config.key, settings)\n\t\t}\n\t}, [settings])\n\n\t//////////\n\n\tconst throwIfUnknownSetting = (key: keyof TypedSettings) => {\n\t\tif (!isKnownSetting(key)) {\n\t\t\tthrow alexandriaError(\"unknownSetting\", key)\n\t\t}\n\t}\n\n\t//////////\n\n\tconst cycleBetween = (key: keyof TypedSettings, values: string[]) => {\n\t\tthrowIfUnknownSetting(key)\n\n\t\t// @ts-ignore\n\t\tconst index = values.indexOf(settings[key] as string)\n\t\tconst nextIndex = index === values.length - 1 ? 0 : index + 1\n\n\t\tsetWithValidation(settings => ({\n\t\t\t...settings,\n\t\t\t[key]: values[nextIndex],\n\t\t}))\n\t}\n\n\tconst reset = (key?: keyof TypedSettings) => {\n\t\tif (typeof key === \"undefined\") {\n\t\t\tsetSettings(_ => defaultSettings)\n\t\t\treturn\n\t\t}\n\n\t\tthrowIfUnknownSetting(key)\n\n\t\tsetWithValidation(settings => ({\n\t\t\t...settings,\n\t\t\t// @ts-ignore\n\t\t\t[key]: defaultSettings[key],\n\t\t}))\n\t}\n\n\tconst set = (key: keyof TypedSettings, value: any) => {\n\t\tthrowIfUnknownSetting(key)\n\n\t\t// @ts-ignore\n\t\tif (settings[key] === value) return\n\t\t// @ts-ignore\n\t\tsetSettings(settings => validateSettings({ ...settings, [key]: value }))\n\t}\n\n\tconst toggle = (key: keyof TypedSettings) => {\n\t\tthrowIfUnknownSetting(key)\n\t\tsetWithValidation(settings => ({\n\t\t\t...settings,\n\t\t\t[key]: !settings[key],\n\t\t}))\n\t}\n\n\tconst toggleBetween = (\n\t\tkey: keyof TypedSettings,\n\t\tvalues: [string, string]\n\t) => {\n\t\tthrowIfUnknownSetting(key)\n\t\tsetWithValidation(settings => ({\n\t\t\t...settings,\n\t\t\t// @ts-ignore\n\t\t\t[key]: settings[key] === values[0] ? values[1] : values[0],\n\t\t}))\n\t}\n\n\tconst operatingContext: AlexandriaOperatingContext<TypedSettings> = {\n\t\tready: !isServer,\n\t\tcycleBetween,\n\t\treset,\n\t\tset,\n\t\ttoggle,\n\t\ttoggleBetween,\n\t}\n\n\tconst alexandria: AlexandriaOperatingContext<TypedSettings> &\n\t\tTypedSettings = {\n\t\t...settings,\n\t\t...operatingContext,\n\t}\n\n\treturn alexandria\n}\n","import React from \"react\"\n\nimport { AlexandriaProvider } from \"./AlexandriaProvider\"\nimport { useAlexandria } from \"./useAlexandria\"\n\nimport { Schema } from \"./types\"\n\nexport const createAlexandria = <TypedSettings extends {}>(schema: Schema) => {\n\tconst Provider = ({ children }: { children: React.ReactNode }) => (\n\t\t<AlexandriaProvider<TypedSettings> schema={schema}>\n\t\t\t{children}\n\t\t</AlexandriaProvider>\n\t)\n\n\tconst Consumer = () => {\n\t\treturn useAlexandria<TypedSettings>()\n\t}\n\n\treturn {\n\t\tProvider,\n\t\tConsumer,\n\t}\n}\n"],"names":["createAlexandriaContext","createContext","isServer","window","saveObject","key","value","localStorage","setItem","JSON","stringify","e","getBlob","undefined","blob","getItem","getSavedObject","fallback","parse","PREFIX","errors","unknownSetting","invalidSettingValue","schema","allow","invalidSchema","emptySchema","alexandriaError","error","Error","args","isAllowedValue","setting","validate","valid","includes","compileDefaultSettingsFromSchema","settings","Object","keys","length","entries","defaultConfig","AlexandriaProvider","userConfig","config","children","AlexandriaContext","defaultSettings","loadSettings","useState","setSettings","React","Provider","useAlexandria","useContext","setIsServer","knownSettings","isKnownSetting","validateSettings","settingsToValidate","newSettings","known","allowed","setWithValidation","cb","useEffect","savedSettings","throwIfUnknownSetting","cycleBetween","values","index","indexOf","nextIndex","reset","_","set","toggle","toggleBetween","operatingContext","ready","alexandria","createAlexandria","Consumer"],"mappings":"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"}